<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Set Daddy</title>
<style>
/* ======= Dark‑mode styling ======= */
body {
  font-family: Arial, sans-serif;
  margin: 2rem;
  background: #1e1e1e;          /* dark background */
  color: #e0e0e0;               /* light text */
}

h1, h2 {
  margin-top: 1;
}

img {
    float: right;
    margin-left: 20px;
    max-width: 300px;
}

label {
  display:block;
  margin-top:1rem;
  margin-bottom:1rem;
  font-weight:bold;
  color: #cfcfcf;
}

textarea, input[type="number"] {
  width:100%;
  padding:0.5rem;
  font-family:monospace;
  background: #2d2d2d;          /* slightly lighter textarea */
  color: #dcdcdc;
  border: 1px solid #444;
  border-radius: 3px;
}

textarea {
  height:200px;
}

button {
  margin-top:1rem;
  padding:0.7rem 1.5rem;
  font-size:1rem;
  background:#3a3a3a;
  color:#e0e0e0;
  border:1px solid #555;
  border-radius:3px;
  cursor:pointer;
}

button:hover {
  background:#4a4a4a;
}

#output {
  margin-top:2rem;
  white-space:pre-wrap;
  background:#2d2d2d;
  padding:1rem;
  border:1px solid #444;
  border-radius:3px;
  color:#dcdcdc;
}

.example {
  background:#3a3a3a;
  padding:0.5rem;
  margin-top:0.5rem;
  font-family:monospace;
  color:#dcdcdc;
}
</style>
</head>
<body>
<img src="logo.png" alt="Set Daddy">

<h1>Set Daddy</h1>
<h2>Papa provides. You practice.</h2>
<p>
  <strong>Data entry format:</strong>
  <br><br>
  <code>song title, cb/ncb (chop buster or not chop buster), speed, duration (minutes)</code>
</p>

<label for="songInput">Enter songs:</label>
<textarea id="songInput" placeholder="e.g.&#10;nola medley, ncb, moderate, 5&#10;thats it, cb, fast, 7"></textarea>

<label for="setLength">Set length (minutes):</label>
<input type="number" id="setLength" min="1" value="15">

<button id="generateBtn">Generate Setlist</button>

<h2>Output</h2>
<pre id="output"></pre>

<script>
/* ======= Utility functions ======= */

/**
 * Shuffle an array in place (Fisher‑Yates)
 */
function shuffle(array) {
  for (let i = array.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [array[i], array[j]] = [array[j], array[i]];
  }
}

/**
 * Parse the text from the textarea into an array of song objects
 * Each object: { title, cb (bool), pace, duration }
 */
function parseSongs(text) {
  const lines = text.split('\n');
  const songs = [];

  for (let raw of lines) {
    raw = raw.trim();
    if (!raw) continue;                     // skip empty lines
    const parts = raw.split(',').map(p => p.trim().toLowerCase());
    if (parts.length !== 4) continue;       // invalid line – skip
    const [title, cbFlag, pace, durStr] = parts;
    const duration = parseFloat(durStr);
    if (isNaN(duration)) continue;          // invalid duration – skip
    const cb = cbFlag === 'cb';              // true if chop‑buster
    songs.push({ title, cb, pace, duration });
  }
  return songs;
}

/**
 * Build a single setlist that satisfies all constraints
 * @param {Array} songs   – array of song objects
 * @param {number} setLen – desired total minutes
 * @returns {Array} – chosen songs in order
 */
function buildSet(songs, setLen) {
  const cbSongs = songs.filter(s => s.cb);
  const nonCbSongs = songs.filter(s => !s.cb);
  shuffle(cbSongs);
  shuffle(nonCbSongs);

  // Helper to try building with a given cb position (2 or 3)
  function tryWithCb(pos) {
    if (!cbSongs.length) return null;       // no cb – skip
    const cb = cbSongs[0];                  // take the first cb
    const result = [];
    let total = 0;
    let lastPace = null;

    function addSong(song) {
      if (lastPace === 'slow' && song.pace === 'slow') return false;
      result.push(song);
      total += song.duration;
      lastPace = song.pace;
      return true;
    }

    // Fill up to the desired index with regular songs
    for (let i = 0; i < pos - 1; i++) {
      const next = nonCbSongs.shift();
      if (!next) break;
      if (!addSong(next)) break;
    }

    // Add the chop‑buster
    if (!addSong(cb)) return null;

    // Continue adding until we reach or exceed set length
    while (total < setLen && nonCbSongs.length) {
      const next = nonCbSongs.shift();
      if (!addSong(next)) continue; // skip if would break rules
    }

    // Trim if we exceeded
    while (total > setLen && result.length) {
      const last = result.pop();
      total -= last.duration;
    }

    // Verify cb is in position 2 or 3
    const cbIndex = result.findIndex(s => s.cb);
    if (cbIndex !== 1 && cbIndex !== 2) return null;

    return result;
  }

  let set = tryWithCb(2) || tryWithCb(3);
  if (!set) return [];  // cannot satisfy constraints
  return set;
}

/* ======= UI event handlers ======= */

document.getElementById('generateBtn').addEventListener('click', () => {
  const inputText = document.getElementById('songInput').value;
  const setLen = parseInt(document.getElementById('setLength').value, 10);
  if (isNaN(setLen) || setLen <= 0) {
    alert('Please enter a valid set length (minutes).');
    return;
  }

  const songs = parseSongs(inputText);
  if (!songs.length) {
    alert('No valid songs were found in the input.');
    return;
  }

  const set = buildSet(songs, setLen);

  if (!set.length) {
    document.getElementById('output').textContent =
      'Couldn’t build a set that meets all constraints with the supplied songs.';
    return;
  }

  // Pretty‑print the result
  const lines = set.map((s, i) => {
    const cbMark = s.cb ? ' (CB)' : '';
    return `${i + 1}. ${s.title}${cbMark} – ${s.pace} – ${s.duration} min`;
  });
  lines.push(`\nTotal: ${set.reduce((a, s) => a + s.duration, 0)} min`);
  document.getElementById('output').textContent = lines.join('\n');
});
</script>

<h2>Tunes</h2>
<p>bad guy, ncb, fast, 3</p>
<p>bella ciao, ncb, moderate, 2</p>
<p>besame, ncb, moderate, 5</p>
<p>beyoncelina, ncb, fast, 4</p>
<p>big shoes, ncb, moderate, 5</p>
<p>blackbird, ncb, fast, 5</p>
<p>bourbon, ncb, moderate, 4</p>
<p>brass riot, cb, fast, 4</p>
<p>bump, ncb, slow, 4</p>
<p>candombe, ncb, slow, 5</p>
<p>clandespacito, ncb, slow, 5</p>
<p>cumbia, ncb, slow, 5</p>
<p>dwyw, ncb, moderate, 4</p>
<p>freedom, ncb, moderate, 3</p>
<p>funkapocalyptic, cb, fast, 5</p>
<p>hot sects, ncb, moderate, 5</p>
<p>just add music, ncb, moderate, 4</p>
<p>katrina, ncb, slow, 5</p>
<p>mad world,  ncb, moderate, 6</p>
<p>master blaster, ncb, slow, 4</p>
<p>mercy, ncb, moderate, 8</p>
<p>nola medley, ncb, moderate, 5</p>
<p>pepas, ncb, moderate, 4</p>
<p>pinch, cb, moderate, 4</p>
<p>ppc, ncb, slow, 4</p>
<p>rage, ncb, moderate, 3</p>
<p>rws, ncb, moderate, 7</p>
<p>shake, cb, fast, 4</p>
<p>slice, ncb, moderate, 6</p>
<p>thats it, cb, fast, 4</p>
<p>toxic, cb, fast, 3</p>
<p>track shot, ncb, slow, 6</p>
<p>trust the poets, ncb, slow, 5</p>
<p>tubman, ncb, slow, 5</p>
<p>waltzing with rhonda, ncb, slow, 3</p>
</body>
</html>